<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Think Narcissus Fell In - zaivion hampden</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main class="project-page narcissus-project-page">
        <div class="page-content">
            <!-- Header with Home and Back -->
            <div class="notable-work-header">
                <div class="header-item">
                    <a href="index.html" class="home-link-header">home</a>
                    <a href="projects.html" class="back-link-header" style="margin-left: 1.5rem;">back</a>
                </div>
                <div class="header-item">
                    <!-- Empty for spacing -->
                </div>
            </div>
            
            <div class="project-header">
                <div class="project-title-column">
                    <h1 class="project-title narcissus-title">
                        <i><span class="narcissus-title-main">I Think Narcissus Fell In </span></i><span class="project-year narcissus-year">(2025)</span>
                    </h1>
                    <p class="project-subtitle narcissus-subtitle" id="narcissus-subtitle">
                        <i>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</i>
                    </p>
                </div>
                <div class="project-spacer"></div>
                <div class="project-description-column">
                    <p class="project-description narcissus-description" id="narcissus-description">
                        <i>I Think Narcissus Fell In</i> is my first-ever directive collection, spanning six pieces designed and created over the span of 3 months. The body of work draws on the Greek myth of Narcissus, subverting the idea that he died staring at his own reflection by instead posing that he died in an attempt to find it. Ego is never truly the result of bad character, but rather the protection of a weak one. To be true to oneself, one must tear down their Ego and confront all flaws.
                    </p>
                </div>
            </div>
            
            <!-- Piece 1: Me -->
            <div class="project-piece">
                <div class="piece-main-row">
                    <div class="piece-image-column">
                        <div class="piece-image-placeholder multi-image-row">
                            <img src="images/i-think-narcissus-fell-in/1/1.jpeg" alt="Me - view 1" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/1/2.jpeg" alt="Me - view 2" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/1/3.jpeg" alt="Me - view 3" loading="lazy">
                        </div>
                    </div>
                    <div class="piece-info-column">
                        <h3 class="piece-title narcissus-piece-title"><i><b>Me</b></i></h3>
                        <p class="piece-details narcissus-piece-details">size</p>
                        <p class="piece-details narcissus-piece-details">Speckled Stoneware</p>
                        <p class="piece-caption narcissus-piece-caption">a stone cast to the water<br>breaks the surface ever so simply,<br>making waves,<br>scattering reflections.<br>the splash, so sudden, so–<br>the surface returns to calm,<br>but my reflection is gone.<br>"You look exactly like your father,"<br>They say to me.</p>
                    </div>
                </div>
                <div class="piece-media-row">
                    <div class="piece-media-column">
                        <div class="mixed-media-row" data-piece-id="1">
                            <div class="mixed-media-thumbnails">
                                <div class="mixed-media-placeholder">media</div>
                                <div class="mixed-media-placeholder">media</div>
                                <div class="mixed-media-placeholder">media</div>
                            </div>
                            <div class="mixed-media-audio-wrapper">
                                <audio controls data-audio-src="images/i-think-narcissus-fell-in/1/audio.mp3">
                                    <source src="images/i-think-narcissus-fell-in/1/audio.mp3" type="audio/mpeg">
                                    <source src="images/i-think-narcissus-fell-in/1/audio.wav" type="audio/wav">
                                    <source src="images/i-think-narcissus-fell-in/1/audio.m4a" type="audio/mp4">
                                </audio>
                            </div>
                        </div>
                    </div>
                    <div class="piece-media-spacer"></div>
                </div>
            </div>
            
            <!-- Piece 2: Name Your Price -->
            <div class="project-piece">
                <div class="piece-main-row">
                    <div class="piece-image-column">
                        <div class="piece-image-placeholder multi-image-row">
                            <img src="images/i-think-narcissus-fell-in/2/1.jpg" alt="Name Your Price - view 1" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/2/2.jpg" alt="Name Your Price - view 2" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/2/3.jpg" alt="Name Your Price - view 3" loading="lazy">
                        </div>
                    </div>
                    <div class="piece-info-column">
                        <h3 class="piece-title narcissus-piece-title"><i><b>Name Your Price</b></i></h3>
                        <p class="piece-details narcissus-piece-details">size</p>
                        <p class="piece-details narcissus-piece-details">Speckled Stoneware</p>
                        <p class="piece-caption narcissus-piece-caption">sometimes it's thirty-five,<br>other times it's twenty.<br>twelve at the pharmacy,<br>fifty-five at the studio.<br>what does my happiness cost?<br>a foggy mirror.<br>it's too hard to remember,<br>or maybe too easy to forget.</p>
                    </div>
                </div>
                <div class="piece-media-row">
                    <div class="piece-media-column">
                        <div class="mixed-media-row" data-piece-id="2">
                            <div class="mixed-media-thumbnails">
                                <div class="mixed-media-placeholder">media</div>
                                <div class="mixed-media-placeholder">media</div>
                            </div>
                            <div class="mixed-media-audio-wrapper">
                                <audio controls data-audio-src="images/i-think-narcissus-fell-in/2/audio.mp3">
                                    <source src="images/i-think-narcissus-fell-in/2/audio.mp3" type="audio/mpeg">
                                    <source src="images/i-think-narcissus-fell-in/2/audio.wav" type="audio/wav">
                                    <source src="images/i-think-narcissus-fell-in/2/audio.m4a" type="audio/mp4">
                                </audio>
                            </div>
                        </div>
                    </div>
                    <div class="piece-media-spacer"></div>
                </div>
            </div>
            
            <!-- Piece 3: Echoes Interlude -->
            <div class="project-piece">
                <div class="piece-main-row">
                    <div class="piece-image-column">
                        <div class="piece-image-placeholder multi-image-row">
                            <img src="images/i-think-narcissus-fell-in/3/1.jpg" alt="Echoes Interlude - view 1" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/3/2.jpg" alt="Echoes Interlude - view 2" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/3/3.jpg" alt="Echoes Interlude - view 3" loading="lazy">
                        </div>
                    </div>
                    <div class="piece-info-column">
                        <h3 class="piece-title narcissus-piece-title"><i><b>Echoes Interlude</b></i></h3>
                        <p class="piece-details narcissus-piece-details">size</p>
                        <p class="piece-details narcissus-piece-details">White Stoneware</p>
                        <p class="piece-caption narcissus-piece-caption">a stone cast to the water<br>breaks the surface ever so simply,<br>making waves,<br>scattering reflections.<br>the splash, so sudden, so–<br>the surface returns to calm,<br>but my reflection is gone.<br>"You look exactly like your father,"<br>They say to me.</p>
                    </div>
                </div>
                <div class="piece-media-row">
                    <div class="piece-media-column">
                        <div class="mixed-media-row" data-piece-id="3">
                            <div class="mixed-media-thumbnails">
                                <div class="mixed-media-placeholder">media</div>
                                <div class="mixed-media-placeholder">media</div>
                            </div>
                            <div class="mixed-media-audio-wrapper">
                                <audio controls data-audio-src="images/i-think-narcissus-fell-in/3/audio.mp3">
                                    <source src="images/i-think-narcissus-fell-in/3/audio.mp3" type="audio/mpeg">
                                    <source src="images/i-think-narcissus-fell-in/3/audio.wav" type="audio/wav">
                                    <source src="images/i-think-narcissus-fell-in/3/audio.m4a" type="audio/mp4">
                                </audio>
                            </div>
                        </div>
                    </div>
                    <div class="piece-media-spacer"></div>
                </div>
            </div>

            <!-- Piece 4: Let's Dance Until Sunday -->
            <div class="project-piece">
                <div class="piece-main-row">
                    <div class="piece-image-column">
                        <div class="piece-image-placeholder multi-image-row">
                            <img src="images/i-think-narcissus-fell-in/4/1.jpg" alt="Let's Dance Until Sunday - view 1" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/4/2.jpg" alt="Let's Dance Until Sunday - view 2" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/4/3.jpg" alt="Let's Dance Until Sunday - view 3" loading="lazy">
                        </div>
                    </div>
                    <div class="piece-info-column">
                        <h3 class="piece-title narcissus-piece-title"><i><b>Let's Dance Until Sunday</b></i></h3>
                        <p class="piece-details narcissus-piece-details">size</p>
                        <p class="piece-details narcissus-piece-details">White Stoneware</p>
                        <p class="piece-caption narcissus-piece-caption">the light from the fire<br>dances on your face tonight.<br>our eyes meet, yet,<br>we always seem to look away.<br>warmth from the flame,<br>from our movements,<br>is a blanket of freedom for my heart.<br>I think of what awaits me,<br>in the dark silence of the trees.<br>no matter, our dance continues.</p>
                    </div>
                </div>
                <div class="piece-media-row">
                    <div class="piece-media-column">
                        <div class="mixed-media-row" data-piece-id="4">
                            <div class="mixed-media-thumbnails">
                                <div class="mixed-media-placeholder">media</div>
                                <div class="mixed-media-placeholder">media</div>
                            </div>
                            <div class="mixed-media-audio-wrapper">
                                <audio controls data-audio-src="images/i-think-narcissus-fell-in/4/audio.mp3">
                                    <source src="images/i-think-narcissus-fell-in/4/audio.mp3" type="audio/mpeg">
                                    <source src="images/i-think-narcissus-fell-in/4/audio.wav" type="audio/wav">
                                    <source src="images/i-think-narcissus-fell-in/4/audio.m4a" type="audio/mp4">
                                </audio>
                            </div>
                        </div>
                    </div>
                    <div class="piece-media-spacer"></div>
                </div>
            </div>
            
            <!-- Piece 5: Death is a Stone Cast -->
            <div class="project-piece">
                <div class="piece-main-row">
                    <div class="piece-image-column">
                        <div class="piece-image-placeholder multi-image-row">
                            <img src="images/i-think-narcissus-fell-in/5/1.jpg" alt="Death is a Stone Cast - view 1" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/5/2.jpg" alt="Death is a Stone Cast - view 2" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/5/3.jpg" alt="Death is a Stone Cast - view 3" loading="lazy">
                        </div>
                    </div>
                    <div class="piece-info-column">
                        <h3 class="piece-title narcissus-piece-title"><i><b>Death is a Stone Cast</b></i></h3>
                        <p class="piece-details narcissus-piece-details">size</p>
                        <p class="piece-details narcissus-piece-details">White Stoneware</p>
                        <p class="piece-caption narcissus-piece-caption">a stone cast to the water<br>breaks the surface ever so simply,<br>making waves,<br>scattering reflections.<br>the splash, so sudden, so–<br>the surface returns to calm,<br>but my reflection is gone.<br>"You look exactly like your father,"<br>They say to me.</p>
                    </div>
                </div>
                <div class="piece-media-row">
                    <div class="piece-media-column">
                        <div class="mixed-media-row" data-piece-id="5">
                            <div class="mixed-media-thumbnails">
                                <div class="mixed-media-placeholder">media</div>
                                <div class="mixed-media-placeholder">media</div>
                            </div>
                            <div class="mixed-media-audio-wrapper">
                                <audio controls data-audio-src="images/i-think-narcissus-fell-in/5/audio.mp3">
                                    <source src="images/i-think-narcissus-fell-in/5/audio.mp3" type="audio/mpeg">
                                    <source src="images/i-think-narcissus-fell-in/5/audio.wav" type="audio/wav">
                                    <source src="images/i-think-narcissus-fell-in/5/audio.m4a" type="audio/mp4">
                                </audio>
                            </div>
                        </div>
                    </div>
                    <div class="piece-media-spacer"></div>
                </div>
            </div>

            <!-- Piece 6: Me, Again -->
            <div class="project-piece">
                <div class="piece-main-row">
                    <div class="piece-image-column">
                        <div class="piece-image-placeholder multi-image-row">
                            <img src="images/i-think-narcissus-fell-in/6/1.jpg" alt="Me, Again - view 1" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/6/2.jpg" alt="Me, Again - view 2" loading="lazy">
                            <img src="images/i-think-narcissus-fell-in/6/3.jpg" alt="Me, Again - view 3" loading="lazy">
                        </div>
                    </div>
                    <div class="piece-info-column">
                        <h3 class="piece-title narcissus-piece-title"><i><b>Me, Again</b></i></h3>
                        <p class="piece-details narcissus-piece-details">size</p>
                        <p class="piece-details narcissus-piece-details">White Stoneware</p>
                        <p class="piece-caption narcissus-piece-caption">a stone cast to the water<br>breaks the surface ever so simply,<br>making waves,<br>scattering reflections.<br>the splash, so sudden, so–<br>the surface returns to calm,<br>but my reflection is gone.<br>"You look exactly like your father,"<br>They say to me.</p>
                    </div>
                </div>
                <div class="piece-media-row">
                    <div class="piece-media-column">
                        <div class="mixed-media-row" data-piece-id="6">
                            <div class="mixed-media-thumbnails">
                                <div class="mixed-media-placeholder">media</div>
                                <div class="mixed-media-placeholder">media</div>
                            </div>
                            <div class="mixed-media-audio-wrapper">
                                <audio controls data-audio-src="images/i-think-narcissus-fell-in/6/audio.mp3">
                                    <source src="images/i-think-narcissus-fell-in/6/audio.mp3" type="audio/mpeg">
                                    <source src="images/i-think-narcissus-fell-in/6/audio.wav" type="audio/wav">
                                    <source src="images/i-think-narcissus-fell-in/6/audio.m4a" type="audio/mp4">
                                </audio>
                            </div>
                        </div>
                    </div>
                    <div class="piece-media-spacer"></div>
                </div>
            </div>
            
            <!-- Closing Text -->
            <p class="extras-closing-text" id="extras-closing-text"><i>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</i></p>
            
            <!-- Extras Section -->
            <div class="extras-section">
                <h2 class="extras-title" id="extras-title">Extras</h2>
                <p class="extras-subtitle" id="extras-subtitle"><i>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</i></p>
                <div class="extras-carousel-container">
                    <button class="extras-carousel-arrow extras-carousel-arrow-left" id="extras-carousel-left" aria-label="Previous">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <div class="extras-carousel-wrapper">
                        <div class="extras-carousel-track" id="extras-carousel-track">
                            <!-- Extras media will be loaded here -->
                        </div>
                        <div class="extras-carousel-fade-left"></div>
                        <div class="extras-carousel-fade-right"></div>
                    </div>
                    <button class="extras-carousel-arrow extras-carousel-arrow-right" id="extras-carousel-right" aria-label="Next">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Extras Overlay (for extras media) -->
    <div class="extras-overlay" id="extras-overlay">
        <div class="extras-overlay-backdrop" id="extras-overlay-backdrop"></div>
        <div class="extras-overlay-content">
            <div class="extras-overlay-media" id="extras-overlay-media">
                <!-- Media will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Image Overlay (for main piece images and secondary angles) -->
    <div class="image-overlay" id="image-overlay">
        <div class="image-overlay-backdrop" id="image-overlay-backdrop"></div>
        <div class="image-overlay-content">
            <div class="image-overlay-grid" id="image-overlay-grid">
                <div class="overlay-image-cell">
                    <div class="image-overlay-placeholder">
                        <span>Enlarged Image</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Thumbnail Overlay (for design/video/audio thumbnails) -->
    <div class="thumbnail-overlay" id="thumbnail-overlay">
        <div class="thumbnail-overlay-backdrop" id="thumbnail-overlay-backdrop"></div>
        <div class="thumbnail-overlay-content">
            <button class="carousel-arrow carousel-arrow-left" id="thumbnail-carousel-left" aria-label="Previous">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="thumbnail-overlay-media" id="thumbnail-overlay-media">
                <!-- Media will be loaded here -->
            </div>
            <button class="carousel-arrow carousel-arrow-right" id="thumbnail-carousel-right" aria-label="Next">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- Piece Image Zoom Overlay (for main images 1.jpg, 2.jpg, 3.jpg) -->
    <div class="piece-image-zoom-overlay" id="piece-image-zoom-overlay">
        <div class="piece-image-zoom-backdrop" id="piece-image-zoom-backdrop"></div>
        <div class="piece-image-zoom-content">
            <button class="carousel-arrow carousel-arrow-left" id="main-image-carousel-left" aria-label="Previous">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="piece-image-zoom-media" id="piece-image-zoom-media">
            <img id="piece-zoom-image" src="" alt="Zoomed image">
            </div>
            <button class="carousel-arrow carousel-arrow-right" id="main-image-carousel-right" aria-label="Next">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Image overlay functionality for Narcissus Project
        const clickableImages = document.querySelectorAll('.clickable-image');
        const imageOverlay = document.getElementById('image-overlay');
        const imageOverlayBackdrop = document.getElementById('image-overlay-backdrop');
        const imageOverlayGrid = document.getElementById('image-overlay-grid');

        // Main piece image click - show overlay with main image and secondary angles
        clickableImages.forEach(img => {
            img.addEventListener('click', function(e) {
                e.stopPropagation();
                const title = this.getAttribute('data-image-title');
                const imageId = this.getAttribute('data-project-image');
                const pieceFolder = `images/i-think-narcissus-fell-in/${imageId}`;
                
                // Find the actual image if it's been loaded
                const actualImg = this.querySelector('img');
                let imageSrc = '';
                
                if (actualImg) {
                    imageSrc = actualImg.src;
                } else {
                    // Try to construct the path (new structure with subfolder)
                    imageSrc = `${pieceFolder}/1.jpg`;
                }
                
                // Populate overlay grid with up to three images
                loadOverlayImages(pieceFolder, imageSrc, title);
                
                imageOverlay.classList.add('active');
                document.body.classList.add('image-overlay-active');
                document.body.style.overflow = 'hidden';
            });
        });
        
        // Load up to three images (main + two angles) into overlay grid
        function loadOverlayImages(pieceFolder, mainSrc, title) {
            if (!imageOverlayGrid) return;
            imageOverlayGrid.innerHTML = '';
            
            const addImageCell = (src, altText) => {
                const cell = document.createElement('div');
                cell.className = 'overlay-image-cell';
                cell.innerHTML = `<img src="${src}" alt="${altText}" loading="lazy">`;
                imageOverlayGrid.appendChild(cell);
            };
            
            addImageCell(mainSrc, title || 'Piece image');
            
            for (let i = 2; i <= 3; i++) {
                const extensions = ['jpg', 'jpeg', 'png'];
                let found = false;
                
                extensions.forEach(ext => {
                    if (found) return;
                    const imgPath = `${pieceFolder}/${i}.${ext}`;
                    const testImg = new Image();
                    testImg.onload = () => {
                        if (!found) {
                            found = true;
                            addImageCell(imgPath, `${title || 'Piece'} angle ${i - 1}`);
                        }
                    };
                    testImg.onerror = () => {};
                    testImg.src = imgPath;
                });
            }
        }
        
        // Store media items for each piece (design images, videos, audio)
        const pieceMediaItems = {};
        const pieceMainImages = {};
        let currentCarousel = { items: [], currentIndex: 0, type: null };
        
        // Track currently playing audio to ensure only one plays at a time
        let currentlyPlayingAudio = null;
        
        // Function to stop any currently playing audio
        function stopCurrentlyPlayingAudio() {
            if (currentlyPlayingAudio && !currentlyPlayingAudio.paused) {
                currentlyPlayingAudio.pause();
                currentlyPlayingAudio.currentTime = 0;
                // Remove playing class from associated button if it exists
                const playingButtons = document.querySelectorAll('.media-play-button.playing');
                playingButtons.forEach(btn => btn.classList.remove('playing'));
            }
        }

        // Carousel functions
        function openMediaCarousel(items, startIndex, type) {
            if (items.length === 0) return;
            
            currentCarousel = {
                items: items,
                currentIndex: startIndex,
                type: type
            };
            
            if (type === 'extra') {
                const thumbnailOverlay = document.getElementById('thumbnail-overlay');
                const thumbnailMedia = document.getElementById('thumbnail-overlay-media');
                const leftArrow = document.getElementById('thumbnail-carousel-left');
                const rightArrow = document.getElementById('thumbnail-carousel-right');
                
                displayCarouselItem(thumbnailMedia, items[startIndex]);
                updateCarouselArrows(leftArrow, rightArrow, startIndex, items.length);
                
                thumbnailOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else if (type === 'main') {
                const zoomOverlay = document.getElementById('piece-image-zoom-overlay');
                const zoomMedia = document.getElementById('piece-image-zoom-media');
                const leftArrow = document.getElementById('main-image-carousel-left');
                const rightArrow = document.getElementById('main-image-carousel-right');
                
                displayCarouselItem(zoomMedia, items[startIndex]);
                updateCarouselArrows(leftArrow, rightArrow, startIndex, items.length);
                
                zoomOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function displayCarouselItem(container, item) {
            if (!container || !item) return;
            
            if (item.type === 'image') {
                container.innerHTML = `<img src="${item.src}" alt="${item.alt || 'Media'}" style="max-width: 100%; max-height: 90vh; height: auto; object-fit: contain; display: block; margin: 0 auto;">`;
            } else if (item.type === 'video') {
                container.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                        <video id="carousel-video" src="${item.src}" style="max-width: 100%; max-height: 70vh; display: block; border-radius: 5px;" controls></video>
                        <button class="media-play-button" id="video-play-btn" style="display: none;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                `;
                // Hide controls, show play button
                const video = container.querySelector('#carousel-video');
                const playBtn = container.querySelector('#video-play-btn');
                if (video && playBtn) {
                    video.controls = false;
                    playBtn.style.display = 'flex';
                    playBtn.onclick = () => {
                        video.play();
                        playBtn.classList.add('playing');
                        playBtn.style.display = 'none';
                        video.controls = true;
                    };
                    video.onpause = () => {
                        playBtn.classList.remove('playing');
                        playBtn.style.display = 'flex';
                        video.controls = false;
                    };
                }
            } else if (item.type === 'audio') {
                container.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                        <audio id="carousel-audio" src="${item.src}" style="display: none;"></audio>
                        <button class="media-play-button" id="audio-play-btn">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                `;
                const audio = container.querySelector('#carousel-audio');
                const playBtn = container.querySelector('#audio-play-btn');
                if (audio && playBtn) {
                    playBtn.onclick = () => {
                        if (audio.paused) {
                            // Stop any currently playing audio
                            stopCurrentlyPlayingAudio();
                            // Set this as the currently playing audio
                            currentlyPlayingAudio = audio;
                            audio.play();
                            playBtn.classList.add('playing');
                        } else {
                            audio.pause();
                            playBtn.classList.remove('playing');
                            if (currentlyPlayingAudio === audio) {
                                currentlyPlayingAudio = null;
                            }
                        }
                    };
                    audio.onended = () => {
                        playBtn.classList.remove('playing');
                        if (currentlyPlayingAudio === audio) {
                            currentlyPlayingAudio = null;
                        }
                    };
                }
            }
        }

        function updateCarouselArrows(leftArrow, rightArrow, currentIndex, totalItems) {
            if (leftArrow) {
                leftArrow.classList.toggle('hidden', currentIndex === 0);
            }
            if (rightArrow) {
                rightArrow.classList.toggle('hidden', currentIndex === totalItems - 1);
            }
        }

        function navigateCarousel(direction) {
            if (currentCarousel.items.length === 0) return;
            
            const newIndex = currentCarousel.currentIndex + direction;
            if (newIndex < 0 || newIndex >= currentCarousel.items.length) return;
            
            currentCarousel.currentIndex = newIndex;
            
            if (currentCarousel.type === 'extra') {
                const thumbnailMedia = document.getElementById('thumbnail-overlay-media');
                const leftArrow = document.getElementById('thumbnail-carousel-left');
                const rightArrow = document.getElementById('thumbnail-carousel-right');
                displayCarouselItem(thumbnailMedia, currentCarousel.items[newIndex]);
                updateCarouselArrows(leftArrow, rightArrow, newIndex, currentCarousel.items.length);
            } else if (currentCarousel.type === 'main') {
                const zoomMedia = document.getElementById('piece-image-zoom-media');
                const leftArrow = document.getElementById('main-image-carousel-left');
                const rightArrow = document.getElementById('main-image-carousel-right');
                displayCarouselItem(zoomMedia, currentCarousel.items[newIndex]);
                updateCarouselArrows(leftArrow, rightArrow, newIndex, currentCarousel.items.length);
            }
        }

        // Arrow click handlers
        document.getElementById('thumbnail-carousel-left')?.addEventListener('click', (e) => {
            e.stopPropagation();
            navigateCarousel(-1);
        });
        document.getElementById('thumbnail-carousel-right')?.addEventListener('click', (e) => {
            e.stopPropagation();
            navigateCarousel(1);
        });
        document.getElementById('main-image-carousel-left')?.addEventListener('click', (e) => {
            e.stopPropagation();
            navigateCarousel(-1);
        });
        document.getElementById('main-image-carousel-right')?.addEventListener('click', (e) => {
            e.stopPropagation();
            navigateCarousel(1);
        });

        // Thumbnail click handlers (for design/video/audio thumbnails)
        document.addEventListener('click', function(e) {
            const thumbnail = e.target.closest('.clickable-thumbnail');
            if (thumbnail) {
                e.preventDefault();
                e.stopPropagation();
                
                const pieceId = thumbnail.closest('.mixed-media-row')?.getAttribute('data-piece-id');
                if (!pieceId) return;
                
                const thumbSrc = thumbnail.getAttribute('data-thumb-src');
                const thumbType = thumbnail.getAttribute('data-thumb-type');
                
                // Get all media items for this piece
                const mediaItems = pieceMediaItems[pieceId] || [];
                if (mediaItems.length === 0) return;
                
                // Find the index of the clicked item
                const currentIndex = mediaItems.findIndex(item => item.src === thumbSrc);
                if (currentIndex === -1) return;
                
                openMediaCarousel(mediaItems, currentIndex, 'extra');
            }
        });
        
        // Close thumbnail overlay
        const thumbnailOverlay = document.getElementById('thumbnail-overlay');
        const thumbnailBackdrop = document.getElementById('thumbnail-overlay-backdrop');
        const thumbnailContent = document.querySelector('.thumbnail-overlay-content');
        
        function closeThumbnailOverlay() {
            thumbnailOverlay.classList.remove('active');
            document.body.style.overflow = '';
            // Stop any playing media
            const audio = thumbnailOverlay.querySelector('audio');
            const video = thumbnailOverlay.querySelector('video');
            if (audio) {
                audio.pause();
                if (currentlyPlayingAudio === audio) {
                    currentlyPlayingAudio = null;
                }
            }
            if (video) video.pause();
        }
        
        if (thumbnailBackdrop) {
            thumbnailBackdrop.addEventListener('click', closeThumbnailOverlay);
        }
        
        // Close when clicking on the content area (but not on arrows or play buttons)
        if (thumbnailContent) {
            thumbnailContent.addEventListener('click', function(e) {
                // Don't close if clicking on arrows or play buttons
                if (e.target.closest('.carousel-arrow') || e.target.closest('.media-play-button')) {
                    return;
                }
                // Close if clicking anywhere else on the overlay
                closeThumbnailOverlay();
            });
        }
        
        // Load mixed media thumbnails and audio
        function loadMixedMediaThumbnails() {
            const mixedMediaRows = document.querySelectorAll('.mixed-media-row');
            mixedMediaRows.forEach(row => {
                const pieceId = row.getAttribute('data-piece-id');
                const pieceFolder = `images/i-think-narcissus-fell-in/${pieceId}`;
                
                // Initialize media items array for this piece
                if (!pieceMediaItems[pieceId]) {
                    pieceMediaItems[pieceId] = [];
                }
                
                // Separate arrays for different media types (to maintain order: images, videos, audio)
                const designImages = [];
                const videos = [];
                let designCheckedCount = 0;
                let videoChecked = false;
                const totalDesignToCheck = 5;
                
                // Load design thumbnails
                const thumbnailsContainer = row.querySelector('.mixed-media-thumbnails');
                let thumbnailsInitialized = false;
                
                // Function to rebuild thumbnails in correct order
                const rebuildThumbnails = () => {
                    if (!thumbnailsContainer) return;
                    
                    // Clear existing thumbnails and media items array
                    thumbnailsContainer.innerHTML = '';
                    pieceMediaItems[pieceId] = []; // Reset array to avoid duplicates
                    thumbnailsInitialized = true;
                    
                    // 1. Add design images first
                            designImages.sort((a, b) => a.index - b.index).forEach(img => {
                        // Add to media items array (images come first)
                        pieceMediaItems[pieceId].push({
                            type: 'image',
                            src: img.path,
                            alt: `Design ${img.index}`
                        });
                        
                                const thumbDiv = document.createElement('div');
                                thumbDiv.className = 'mixed-media-thumbnail clickable-thumbnail';
                                thumbDiv.setAttribute('data-thumb-type', 'design');
                                thumbDiv.setAttribute('data-thumb-src', img.path);
                                thumbDiv.style.cssText = 'width: 120px; height: 120px; border-radius: 4px; cursor: pointer; overflow: hidden; flex-shrink: 0;';
                                thumbDiv.innerHTML = `<img src="${img.path}" alt="Design ${img.index}" style="width: 100%; height: 100%; object-fit: cover;">`;
                                thumbnailsContainer.appendChild(thumbDiv);
                            });
                    
                    // 2. Add videos after images
                    videos.forEach(video => {
                        // Add to media items array (videos come after images)
                        pieceMediaItems[pieceId].push({
                            type: 'video',
                            src: video.path
                        });
                        
                        const thumbDiv = document.createElement('div');
                        thumbDiv.className = 'mixed-media-thumbnail clickable-thumbnail';
                        thumbDiv.setAttribute('data-thumb-type', 'video');
                        thumbDiv.setAttribute('data-thumb-src', video.path);
                        thumbDiv.style.cssText = 'width: 120px; height: 120px; border-radius: 4px; cursor: pointer; overflow: hidden; flex-shrink: 0; position: relative;';
                        thumbDiv.innerHTML = `<video src="${video.path}" style="width: 100%; height: 100%; object-fit: cover;" muted></video><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: rgba(255,255,255,0.8); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px;">▶</div>`;
                        thumbnailsContainer.appendChild(thumbDiv);
                    });
                };
                
                if (thumbnailsContainer) {
                    // Try to load design images (design-1.jpg, design-2.jpg, etc.) in order
                    for (let i = 1; i <= totalDesignToCheck; i++) {
                        const designPath = `${pieceFolder}/design-${i}.jpg`;
                        const testImg = new Image();
                        testImg.onload = () => {
                            designImages.push({ path: designPath, index: i });
                            designCheckedCount++;
                            if (designCheckedCount === totalDesignToCheck && !thumbnailsInitialized) {
                                rebuildThumbnails();
                            }
                        };
                        testImg.onerror = () => {
                            designCheckedCount++;
                            if (designCheckedCount === totalDesignToCheck && !thumbnailsInitialized) {
                                rebuildThumbnails();
                            }
                        };
                        testImg.src = designPath;
                    }
                    
                    // Try to load video (video.mp4, video.mov, etc.)
                    const videoExtensions = ['mp4', 'mov', 'webm'];
                    videoExtensions.forEach(ext => {
                        const videoPath = `${pieceFolder}/video.${ext}`;
                        const testVideo = document.createElement('video');
                        testVideo.oncanplay = () => {
                            if (!videoChecked) {
                                videoChecked = true;
                                videos.push({ path: videoPath });
                                // Rebuild to include video
                                rebuildThumbnails();
                            }
                        };
                        testVideo.onerror = () => {};
                        testVideo.src = videoPath;
                        testVideo.load();
                    });
                }
                
                // Load audio (only if an actual file exists; otherwise hide the player)
                const audioElement = row.querySelector('audio');
                
                if (audioElement) {
                    const audioWrapper = audioElement.parentElement;
                    const audioExtensions = ['mp3', 'wav', 'm4a'];
                    let audioFound = false;
                    
                    audioExtensions.forEach(ext => {
                        if (audioFound) return;
                        const testPath = `${pieceFolder}/audio.${ext}`;
                        const testAudio = new Audio();
                        testAudio.oncanplay = () => {
                            if (audioFound) return;
                            audioFound = true;
                            
                            const detectedPath = testPath;
                            
                            // Add audio to carousel array (after images and videos)
                            pieceMediaItems[pieceId].push({
                                type: 'audio',
                                src: detectedPath
                            });
                            
                            // Replace audio element with play button
                            if (audioWrapper && !audioWrapper.querySelector('.media-play-button')) {
                                const playbackAudio = new Audio(detectedPath);
                                
                                const playButton = document.createElement('button');
                                playButton.className = 'media-play-button';
                                playButton.innerHTML = `
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                                    </svg>
                                `;
                                playButton.onclick = () => {
                                    if (playbackAudio.paused) {
                                        // Stop any currently playing audio
                                        stopCurrentlyPlayingAudio();
                                        // Set this as the currently playing audio
                                        currentlyPlayingAudio = playbackAudio;
                                        playbackAudio.play();
                                        playButton.classList.add('playing');
                                    } else {
                                        playbackAudio.pause();
                                        playButton.classList.remove('playing');
                                        if (currentlyPlayingAudio === playbackAudio) {
                                            currentlyPlayingAudio = null;
                                        }
                                    }
                                };
                                playbackAudio.onended = () => {
                                    playButton.classList.remove('playing');
                                    if (currentlyPlayingAudio === playbackAudio) {
                                        currentlyPlayingAudio = null;
                                    }
                                };
                                
                                audioElement.style.display = 'none';
                                audioWrapper.appendChild(playButton);
                            }
                        };
                        testAudio.onerror = () => {};
                        testAudio.src = testPath;
                    });
                    
                    // If no audio file is found, hide the audio wrapper completely
                    setTimeout(() => {
                        if (!audioFound && audioWrapper) {
                            audioWrapper.style.display = 'none';
                        }
                    }, 1500);
                }
            });
        }
        
        // Load mixed media on page load
        loadMixedMediaThumbnails();

        // Load ITNFI piece data from text files
        async function loadITNFIPieceData(pieceId) {
            const dataPath = `images/i-think-narcissus-fell-in/${pieceId}/piece-data.txt`;
            const defaultData = {
                title: '',
                size: '',
                medium: '',
                year: '',
                description: ''
            };
            
            try {
                const response = await fetch(dataPath);
                if (!response.ok) return defaultData;
                
                const text = await response.text();
                const lines = text.split('\n');
                
                const data = { ...defaultData };
                let inDescription = false;
                let descriptionLines = [];
                
                lines.forEach(line => {
                    const trimmed = line.trim();
                    if (trimmed.startsWith('title:')) {
                        data.title = trimmed.substring(6).trim();
                        inDescription = false;
                    } else if (trimmed.startsWith('size:')) {
                        data.size = trimmed.substring(5).trim();
                        inDescription = false;
                    } else if (trimmed.startsWith('medium:')) {
                        data.medium = trimmed.substring(7).trim();
                        inDescription = false;
                    } else if (trimmed.startsWith('year:')) {
                        data.year = trimmed.substring(5).trim();
                        inDescription = false;
                    } else if (trimmed.startsWith('description:')) {
                        descriptionLines = [trimmed.substring(12).trim()];
                        inDescription = true;
                    } else if (inDescription) {
                        if (trimmed || descriptionLines.length > 0) {
                            descriptionLines.push(trimmed);
                        }
                    }
                });
                
                if (descriptionLines.length > 0) {
                    // Remove all trailing empty lines
                    while (descriptionLines.length > 0 && descriptionLines[descriptionLines.length - 1].trim() === '') {
                        descriptionLines.pop();
                    }
                    // Always add exactly one empty line at the end
                    if (descriptionLines.length > 0) {
                        descriptionLines.push('');
                    }
                    // Join with newlines, preserving empty lines within the text
                    data.description = descriptionLines.join('\n');
                }
                
                return data;
            } catch (error) {
                console.error('Error loading ITNFI piece data for piece', pieceId, ':', error);
                return defaultData;
            }
        }

        // Update piece HTML with loaded data
        function updatePieceHTML(pieceId, pieceData) {
            // Find the piece container - look for the mixed-media-row with data-piece-id
            const pieceRow = document.querySelector(`.mixed-media-row[data-piece-id="${pieceId}"]`);
            if (!pieceRow) return;
            
            // Find the piece container (go up to project-piece)
            const pieceContainer = pieceRow.closest('.project-piece');
            if (!pieceContainer) return;
            
            // Update title
            const titleElement = pieceContainer.querySelector('.piece-title');
            if (titleElement && pieceData.title) {
                titleElement.innerHTML = `<i><b>${pieceData.title}</b></i>`;
            }
            
            // Update size (only if provided)
            const detailElements = pieceContainer.querySelectorAll('.piece-details');
            if (detailElements.length >= 1) {
                if (pieceData.size && pieceData.size.trim() !== '') {
                    detailElements[0].textContent = pieceData.size;
                    detailElements[0].style.display = '';
                } else {
                    detailElements[0].style.display = 'none';
                }
            }
            
            // Update medium (always show if provided)
            if (detailElements.length >= 2 && pieceData.medium) {
                detailElements[1].textContent = pieceData.medium;
            }
            
            // Update description
            const descriptionElement = pieceContainer.querySelector('.piece-caption');
            if (descriptionElement && pieceData.description) {
                // Convert newlines to <br> tags
                const formattedDescription = pieceData.description.replace(/\n/g, '<br>');
                descriptionElement.innerHTML = formattedDescription;
            }
        }

        // Load and update all ITNFI pieces on page load
        async function loadAllITNFIPieces() {
            for (let pieceId = 1; pieceId <= 6; pieceId++) {
                const pieceData = await loadITNFIPieceData(pieceId);
                updatePieceHTML(pieceId, pieceData);
            }
        }

        // Load piece data on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadAllITNFIPieces);
        } else {
            loadAllITNFIPieces();
        }

        // Load project subtitle and description from text files
        async function loadProjectText() {
            // Load subtitle
            try {
                const subtitleResponse = await fetch('images/i-think-narcissus-fell-in/subtitle.txt');
                if (subtitleResponse.ok) {
                    const subtitleText = await subtitleResponse.text();
                    const subtitleElement = document.getElementById('narcissus-subtitle');
                    if (subtitleElement && subtitleText.trim()) {
                        // Convert line breaks to <br> tags
                        const formattedSubtitle = subtitleText.trim().replace(/\n/g, '<br>');
                        subtitleElement.innerHTML = `<i>${formattedSubtitle}</i>`;
                    }
                }
            } catch (error) {
                console.log('Subtitle file not found, using default content');
            }

            // Load description
            try {
                const descriptionResponse = await fetch('images/i-think-narcissus-fell-in/description.txt');
                if (descriptionResponse.ok) {
                    const descriptionText = await descriptionResponse.text();
                    const descriptionElement = document.getElementById('narcissus-description');
                    if (descriptionElement && descriptionText.trim()) {
                        // Convert line breaks to <br> tags
                        const formattedText = descriptionText.trim().replace(/\n/g, '<br>');
                        descriptionElement.innerHTML = formattedText;
                    }
                }
            } catch (error) {
                console.log('Description file not found, using default content');
            }
        }

        // Load project text on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadProjectText);
        } else {
            loadProjectText();
        }

        function closeImageOverlay() {
            imageOverlay.classList.remove('active');
            document.body.classList.remove('image-overlay-active');
            document.body.style.overflow = '';
        }

        // Close overlay when clicking backdrop
        if (imageOverlayBackdrop) {
            imageOverlayBackdrop.addEventListener('click', closeImageOverlay);
        }

        // Close when clicking on the overlay content area (but not the image grid)
        const imageOverlayContent = document.querySelector('.image-overlay-content');
        if (imageOverlayContent) {
            imageOverlayContent.addEventListener('click', function(e) {
                if (e.target === imageOverlayContent) {
                    closeImageOverlay();
                }
            });
        }

        if (imageOverlayGrid) {
            imageOverlayGrid.addEventListener('click', function(e) {
                if (e.target.tagName === 'IMG') {
                    e.stopPropagation();
                }
            });
        }

        // Close with Escape key (for original overlay)
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && imageOverlay.classList.contains('active')) {
                closeImageOverlay();
            }
        });
        
        // Load main images for each piece and store them
        function loadMainImages() {
            for (let pieceId = 1; pieceId <= 6; pieceId++) {
                const pieceFolder = `images/i-think-narcissus-fell-in/${pieceId}`;
                const mainImages = [];
                
                // Check for main images (1.jpg, 2.jpg, 3.jpg)
                for (let i = 1; i <= 3; i++) {
                    const extensions = ['jpg', 'jpeg', 'png'];
                    let found = false;
                    
                    extensions.forEach(ext => {
                        if (found) return;
                        const imgPath = `${pieceFolder}/${i}.${ext}`;
                        const testImg = new Image();
                        testImg.onload = () => {
                            if (!found) {
                                found = true;
                                mainImages.push({
                                    type: 'image',
                                    src: imgPath,
                                    alt: `Piece ${pieceId} - Image ${i}`
                                });
                            }
                        };
                        testImg.onerror = () => {};
                        testImg.src = imgPath;
                    });
                }
                
                pieceMainImages[pieceId] = mainImages;
            }
        }
        
        loadMainImages();
        
        // Load images for pieces 2-6 with multiple extension support (matching piece 1 format)
        function loadPieceImages() {
            for (let pieceId = 2; pieceId <= 6; pieceId++) {
                const pieceFolder = `images/i-think-narcissus-fell-in/${pieceId}`;
                const pieceContainer = document.querySelector(`.mixed-media-row[data-piece-id="${pieceId}"]`)?.closest('.project-piece');
                if (!pieceContainer) continue;
                
                const imageContainer = pieceContainer.querySelector('.multi-image-row');
                if (!imageContainer) continue;
                
                const imgElements = imageContainer.querySelectorAll('img');
                if (imgElements.length !== 3) continue;
                
                // Update each img element to try different extensions
                imgElements.forEach((img, index) => {
                    const imageNum = index + 1;
                    const extensions = ['jpg', 'jpeg', 'png'];
                    let found = false;
                    
                    extensions.forEach(ext => {
                        if (found) return;
                        const imgPath = `${pieceFolder}/${imageNum}.${ext}`;
                        const testImg = new Image();
                        testImg.onload = () => {
                            if (!found) {
                                found = true;
                                img.src = imgPath;
                            }
                        };
                        testImg.onerror = () => {};
                        testImg.src = imgPath;
                    });
                });
            }
        }
        
        // Load piece images on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadPieceImages);
        } else {
            loadPieceImages();
        }
        
        // Piece Image Zoom Overlay Functionality
        const pieceZoomOverlay = document.getElementById('piece-image-zoom-overlay');
        const pieceZoomBackdrop = document.getElementById('piece-image-zoom-backdrop');
        const pieceZoomContent = document.querySelector('.piece-image-zoom-content');
        
        // Handle clicks on all piece images (both single and multi-image-row)
        document.addEventListener('click', function(e) {
            const img = e.target.closest('.piece-image-placeholder img');
            if (img && pieceZoomOverlay) {
                e.preventDefault();
                e.stopPropagation();
                
                // Get the image source and find which piece it belongs to
                const imgSrc = img.src;
                let pieceId = null;
                let imageIndex = null;
                
                // Find which piece this image belongs to
                for (let pid = 1; pid <= 6; pid++) {
                    const mainImgs = pieceMainImages[pid] || [];
                    const foundIndex = mainImgs.findIndex(item => item.src === imgSrc || imgSrc.includes(`/${pid}/`));
                    if (foundIndex !== -1) {
                        pieceId = pid;
                        imageIndex = foundIndex;
                        break;
                    }
                }
                
                // If we found the piece, use carousel; otherwise fallback to single image
                if (pieceId && pieceMainImages[pieceId] && pieceMainImages[pieceId].length > 0) {
                    openMediaCarousel(pieceMainImages[pieceId], imageIndex || 0, 'main');
                } else {
                    // Fallback: single image display
                    const pieceZoomMedia = document.getElementById('piece-image-zoom-media');
                    if (pieceZoomMedia) {
                        pieceZoomMedia.innerHTML = `<img src="${imgSrc}" alt="${img.alt || 'Zoomed image'}" style="max-width: 100%; max-height: 90vh; height: auto; object-fit: contain; display: block; margin: 0 auto;">`;
                        // Hide arrows for single image
                        document.getElementById('main-image-carousel-left')?.classList.add('hidden');
                        document.getElementById('main-image-carousel-right')?.classList.add('hidden');
                pieceZoomOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
                    }
                }
            }
        });
        
        // Close overlay when clicking backdrop or content
        function closePieceZoomOverlay() {
            if (pieceZoomOverlay) {
                pieceZoomOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        if (pieceZoomBackdrop) {
            pieceZoomBackdrop.addEventListener('click', closePieceZoomOverlay);
        }
        
        if (pieceZoomContent) {
            pieceZoomContent.addEventListener('click', function(e) {
                if (e.target === pieceZoomContent || e.target.closest('.piece-image-zoom-media')) {
                    closePieceZoomOverlay();
                }
            });
        }
        
        // Close zoom overlay with Escape key and handle arrow key navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (pieceZoomOverlay && pieceZoomOverlay.classList.contains('active')) {
                closePieceZoomOverlay();
                }
                if (thumbnailOverlay && thumbnailOverlay.classList.contains('active')) {
                    thumbnailOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                    const audio = thumbnailOverlay.querySelector('audio');
                    const video = thumbnailOverlay.querySelector('video');
                    if (audio) audio.pause();
                    if (video) video.pause();
                }
            }
            
            // Arrow key navigation for carousels (only when a carousel is open)
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                // Check which carousel is currently active
                const isMainCarouselOpen = pieceZoomOverlay && pieceZoomOverlay.classList.contains('active');
                const isThumbnailCarouselOpen = thumbnailOverlay && thumbnailOverlay.classList.contains('active');
                
                // Only navigate if a carousel is open and has items
                if (isMainCarouselOpen && currentCarousel.type === 'main' && currentCarousel.items.length > 0) {
                    e.preventDefault();
                    e.stopPropagation();
                    const direction = e.key === 'ArrowLeft' ? -1 : 1;
                    navigateCarousel(direction);
                } else if (isThumbnailCarouselOpen && currentCarousel.type === 'extra' && currentCarousel.items.length > 0) {
                    e.preventDefault();
                    e.stopPropagation();
                    const direction = e.key === 'ArrowLeft' ? -1 : 1;
                    navigateCarousel(direction);
                }
            }
        });

        // Extras Carousel Functionality
        let extrasItems = [];
        let currentExtrasIndex = 0;
        let extrasCarouselTrack = null;
        let isExtrasTransitioning = false;

        // Load extras title from text file
        async function loadExtrasTitle() {
            try {
                const response = await fetch('images/i-think-narcissus-fell-in/extras/title.txt');
                if (response.ok) {
                    const text = await response.text();
                    const titleElement = document.getElementById('extras-title');
                    if (titleElement && text.trim()) {
                        titleElement.textContent = text.trim();
                    }
                }
            } catch (error) {
                console.log('Extras title file not found, using default');
            }
        }

        // Load extras subtitle from text file
        async function loadExtrasSubtitle() {
            try {
                const response = await fetch('images/i-think-narcissus-fell-in/extras/subtitle.txt');
                if (response.ok) {
                    const text = await response.text();
                    const subtitleElement = document.getElementById('extras-subtitle');
                    if (subtitleElement && text.trim()) {
                        subtitleElement.innerHTML = `<i>${text.trim()}</i>`;
                    }
                }
            } catch (error) {
                console.log('Extras subtitle file not found, using default');
            }
        }

        // Load extras closing text from text file
        async function loadExtrasClosingText() {
            try {
                const response = await fetch('images/i-think-narcissus-fell-in/closing.txt');
                if (response.ok) {
                    const text = await response.text();
                    const closingElement = document.getElementById('extras-closing-text');
                    if (closingElement && text.trim()) {
                        closingElement.innerHTML = `<i>${text.trim()}</i>`;
                    }
                }
            } catch (error) {
                console.log('Extras closing text file not found, using default');
            }
        }

        // Detect file type from extension
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) return 'image';
            if (['mp4', 'mov', 'webm'].includes(ext)) return 'video';
            if (['mp3', 'wav', 'm4a'].includes(ext)) return 'audio';
            return 'unknown';
        }

        // Load all extras media from folder
        async function loadExtrasMedia() {
            const extrasFolder = 'images/i-think-narcissus-fell-in/extras/';
            extrasItems = [];
            
            // Try to load files numbered 1, 2, 3, etc.
            let fileNumber = 1;
            let foundFiles = 0;
            const maxFiles = 50; // Reasonable limit
            
            while (foundFiles < maxFiles) {
                // Try common extensions
                const extensions = [
                    ['jpg', 'jpeg', 'png', 'gif', 'webp'],
                    ['mp4', 'mov', 'webm'],
                    ['mp3', 'wav', 'm4a']
                ];
                
                let fileFound = false;
                
                for (const extGroup of extensions) {
                    for (const ext of extGroup) {
                        const filePath = `${extrasFolder}${fileNumber}.${ext}`;
                        const fileType = getFileType(filePath);
                        
                        // Test if file exists
                        try {
                            const response = await fetch(filePath, { method: 'HEAD' });
                            if (response.ok) {
                                extrasItems.push({
                                    path: filePath,
                                    type: fileType,
                                    number: fileNumber
                                });
                                fileFound = true;
                                foundFiles++;
                                break;
                            }
                        } catch (e) {
                            // File doesn't exist, continue
                        }
                    }
                    if (fileFound) break;
                }
                
                if (!fileFound) {
                    // No more files found, stop
                    break;
                }
                
                fileNumber++;
            }
            
            // Render extras carousel
            renderExtrasCarousel();
        }

        // Render extras carousel items
        function renderExtrasCarousel() {
            extrasCarouselTrack = document.getElementById('extras-carousel-track');
            if (!extrasCarouselTrack) return;
            
            // If no items found, create placeholder items for demonstration
            if (extrasItems.length === 0) {
                extrasItems = [
                    { path: '', type: 'image', number: 1, isPlaceholder: true },
                    { path: '', type: 'image', number: 2, isPlaceholder: true },
                    { path: '', type: 'video', number: 3, isPlaceholder: true },
                    { path: '', type: 'audio', number: 4, isPlaceholder: true },
                    { path: '', type: 'image', number: 5, isPlaceholder: true }
                ];
            }
            
            extrasCarouselTrack.innerHTML = '';
            
            // For infinite carousel, duplicate items
            const itemsToRender = [...extrasItems, ...extrasItems, ...extrasItems];
            
            itemsToRender.forEach((item, index) => {
                const carouselItem = document.createElement('div');
                carouselItem.className = 'extras-carousel-item';
                carouselItem.setAttribute('data-index', index % extrasItems.length);
                carouselItem.setAttribute('data-item-index', index);
                
                if (item.isPlaceholder) {
                    // Create placeholder divs for demonstration
                    if (item.type === 'image') {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'extras-carousel-item-placeholder';
                        placeholder.style.cssText = 'width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-family: "Lora", serif; font-size: 1.2rem;';
                        placeholder.textContent = `Image ${item.number}`;
                        carouselItem.appendChild(placeholder);
                    } else if (item.type === 'video') {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'extras-carousel-item-placeholder';
                        placeholder.style.cssText = 'width: 100%; height: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-family: "Lora", serif; font-size: 1.2rem;';
                        placeholder.textContent = `Video ${item.number}`;
                        carouselItem.appendChild(placeholder);
                    } else if (item.type === 'audio') {
                        const audioPlaceholder = document.createElement('div');
                        audioPlaceholder.className = 'extras-audio-placeholder';
                        audioPlaceholder.textContent = `Audio ${item.number}`;
                        carouselItem.appendChild(audioPlaceholder);
                    }
                } else if (item.type === 'image') {
                    const img = document.createElement('img');
                    img.src = item.path;
                    img.alt = `Extra ${item.number}`;
                    img.loading = 'lazy';
                    carouselItem.appendChild(img);
                } else if (item.type === 'video') {
                    const video = document.createElement('video');
                    video.src = item.path;
                    video.muted = true;
                    video.loop = true;
                    video.playsInline = true;
                    carouselItem.appendChild(video);
                } else if (item.type === 'audio') {
                    const audioPlaceholder = document.createElement('div');
                    audioPlaceholder.className = 'extras-audio-placeholder';
                    audioPlaceholder.textContent = `Audio ${item.number}`;
                    carouselItem.appendChild(audioPlaceholder);
                }
                
                // Click handler to open overlay
                carouselItem.addEventListener('click', () => {
                    openExtrasOverlay(item);
                });
                
                extrasCarouselTrack.appendChild(carouselItem);
            });
            
            // Set initial position to middle set (for infinite scroll)
            currentExtrasIndex = extrasItems.length;
            updateExtrasCarouselPosition();
        }

        // Update carousel position
        function updateExtrasCarouselPosition() {
            if (!extrasCarouselTrack || extrasItems.length === 0) return;
            
            const itemWidth = 400; // Match CSS flex-basis
            const gap = 32; // Match CSS gap (2rem)
            const wrapper = extrasCarouselTrack.closest('.extras-carousel-wrapper');
            if (!wrapper) return;
            
            const wrapperWidth = wrapper.offsetWidth;
            const centerOffset = wrapperWidth / 2 - itemWidth / 2;
            const offset = -(currentExtrasIndex * (itemWidth + gap)) + centerOffset;
            
            // Only apply translateX
            extrasCarouselTrack.style.transform = `translateX(${offset}px)`;
        }
        
        // Handle seamless infinite loop (no jumping)
        function handleExtrasInfiniteLoop() {
            if (!extrasCarouselTrack || extrasItems.length === 0) return;
            
            const totalItems = extrasItems.length * 3; // 3 sets of items
            
            // Seamlessly wrap around - no jumping
            if (currentExtrasIndex >= totalItems) {
                // Went past the end, wrap to beginning seamlessly
                currentExtrasIndex = currentExtrasIndex - totalItems;
                extrasCarouselTrack.style.transition = 'none';
                updateExtrasCarouselPosition();
                setTimeout(() => {
                    extrasCarouselTrack.style.transition = '';
                }, 0);
            } else if (currentExtrasIndex < 0) {
                // Went before the beginning, wrap to end seamlessly
                currentExtrasIndex = totalItems + currentExtrasIndex;
                extrasCarouselTrack.style.transition = 'none';
                updateExtrasCarouselPosition();
                setTimeout(() => {
                    extrasCarouselTrack.style.transition = '';
                }, 0);
            }
        }

        // Navigate extras carousel
        function navigateExtrasCarousel(direction) {
            if (isExtrasTransitioning || extrasItems.length === 0) return;
            
            isExtrasTransitioning = true;
            // Reverse direction
            currentExtrasIndex -= direction;
            updateExtrasCarouselPosition();
            
            // Check for infinite loop after transition completes
            setTimeout(() => {
                handleExtrasInfiniteLoop();
                isExtrasTransitioning = false;
            }, 300);
        }

        // Open extras overlay
        function openExtrasOverlay(item) {
            const overlay = document.getElementById('extras-overlay');
            const overlayMedia = document.getElementById('extras-overlay-media');
            
            if (!overlay || !overlayMedia) return;
            
            overlayMedia.innerHTML = '';
            
            if (item.type === 'image') {
                const img = document.createElement('img');
                img.src = item.path;
                img.alt = `Extra ${item.number}`;
                overlayMedia.appendChild(img);
            } else if (item.type === 'video') {
                const video = document.createElement('video');
                video.src = item.path;
                video.controls = true;
                video.style.maxWidth = '100%';
                video.style.maxHeight = '90vh';
                overlayMedia.appendChild(video);
            } else if (item.type === 'audio') {
                const audio = document.createElement('audio');
                audio.src = item.path;
                audio.controls = true;
                audio.style.width = '100%';
                audio.style.maxWidth = '600px';
                overlayMedia.appendChild(audio);
            }
            
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close extras overlay
        function closeExtrasOverlay() {
            const overlay = document.getElementById('extras-overlay');
            if (overlay) {
                overlay.classList.remove('active');
                document.body.style.overflow = '';
                // Stop any playing audio
                const audio = overlay.querySelector('audio');
                if (audio) {
                    audio.pause();
                    if (currentlyPlayingAudio === audio) {
                        currentlyPlayingAudio = null;
                    }
                }
            }
        }

        // Event listeners for extras carousel
        document.getElementById('extras-carousel-left')?.addEventListener('click', () => {
            navigateExtrasCarousel(1); // Reversed
        });

        document.getElementById('extras-carousel-right')?.addEventListener('click', () => {
            navigateExtrasCarousel(-1); // Reversed
        });

        // Close extras overlay
        document.getElementById('extras-overlay-backdrop')?.addEventListener('click', closeExtrasOverlay);
        document.querySelector('.extras-overlay-content')?.addEventListener('click', function(e) {
            if (e.target === this || e.target.closest('.extras-overlay-media')) {
                closeExtrasOverlay();
            }
        });

        // Close with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const extrasOverlay = document.getElementById('extras-overlay');
                if (extrasOverlay && extrasOverlay.classList.contains('active')) {
                    closeExtrasOverlay();
                }
            }
        });

        // Load extras on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                loadExtrasTitle();
                loadExtrasSubtitle();
                loadExtrasClosingText();
                loadExtrasMedia();
                adjustOrangeBoxHeights();
                hideImagesUntilLoaded();
            });
        } else {
            loadExtrasTitle();
            loadExtrasSubtitle();
            loadExtrasClosingText();
            loadExtrasMedia();
            adjustOrangeBoxHeights();
            hideImagesUntilLoaded();
        }

        // Hide images until they're loaded to prevent alt text from showing
        function hideImagesUntilLoaded() {
            const images = document.querySelectorAll('.narcissus-project-page .piece-image-placeholder img');
            images.forEach(img => {
                if (img.complete && img.naturalHeight > 0) {
                    // Image already loaded
                    img.classList.add('loaded');
                } else {
                    // Wait for image to load
                    img.addEventListener('load', function() {
                        this.classList.add('loaded');
                    });
                    img.addEventListener('error', function() {
                        // Even on error, show it (so alt text appears if needed)
                        this.classList.add('loaded');
                    });
                }
            });
        }

        // Function to adjust orange box heights to end right after blue boxes
        function adjustOrangeBoxHeights() {
            // Wait for images and media to load
            const images = document.querySelectorAll('.narcissus-project-page .piece-image-placeholder img');
            const mediaThumbnails = document.querySelectorAll('.narcissus-project-page .piece-media-row img, .narcissus-project-page .piece-media-row video');
            let imagesLoaded = 0;
            const totalImages = images.length + mediaThumbnails.length;

            if (totalImages === 0) {
                calculateHeights();
                return;
            }

            const checkLoaded = () => {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    // Small delay to ensure layout is complete
                    setTimeout(calculateHeights, 100);
                }
            };

            images.forEach(img => {
                if (img.complete) {
                    checkLoaded();
                } else {
                    img.addEventListener('load', checkLoaded);
                    img.addEventListener('error', checkLoaded);
                }
            });

            mediaThumbnails.forEach(media => {
                if (media.tagName === 'VIDEO') {
                    if (media.readyState >= 2) {
                        checkLoaded();
                    } else {
                        media.addEventListener('loadeddata', checkLoaded);
                        media.addEventListener('error', checkLoaded);
                    }
                } else {
                    if (media.complete) {
                        checkLoaded();
                    } else {
                        media.addEventListener('load', checkLoaded);
                        media.addEventListener('error', checkLoaded);
                    }
                }
            });
        }

        function calculateHeights() {
            const pieces = document.querySelectorAll('.narcissus-project-page .project-piece');
            
            pieces.forEach(piece => {
                const blueBox = piece.querySelector('.piece-media-row');
                const greenBox = piece.querySelector('.piece-info-column');
                
                if (blueBox) {
                    // Get positions relative to the orange box
                    const pieceRect = piece.getBoundingClientRect();
                    const blueBoxRect = blueBox.getBoundingClientRect();
                    
                    // Calculate the bottom of the blue box relative to the top of the orange box
                    const blueBoxBottom = blueBoxRect.bottom - pieceRect.top;
                    
                    // Get the green box bottom if it exists
                    let greenBoxBottom = 0;
                    if (greenBox) {
                        const greenBoxRect = greenBox.getBoundingClientRect();
                        greenBoxBottom = greenBoxRect.bottom - pieceRect.top;
                    }
                    
                    // The orange box should end at the maximum of blue box bottom or green box bottom
                    const maxBottom = Math.max(blueBoxBottom, greenBoxBottom);
                    
                    // Get current padding-top
                    const computedStyle = getComputedStyle(piece);
                    const paddingTop = parseFloat(computedStyle.paddingTop);
                    
                    // Calculate required padding-bottom
                    // maxBottom is the distance from top of orange box to bottom of content
                    // We want the orange box to extend to maxBottom + 0.5rem (bottom padding)
                    // Current height = paddingTop + contentHeight + paddingBottom
                    // We want: paddingTop + contentHeight + newPaddingBottom = maxBottom + 0.5rem
                    // So: newPaddingBottom = maxBottom + 0.5rem - paddingTop - contentHeight
                    
                    // But we need to know the content height. Let's use a different approach:
                    // Set min-height to maxBottom + 0.5rem, keeping padding-bottom at 0.5rem
                    const remToPx = parseFloat(getComputedStyle(document.documentElement).fontSize);
                    piece.style.minHeight = `${maxBottom / remToPx + 0.5}rem`;
                    piece.style.paddingBottom = '0.5rem';
                }
            });
        }
    </script>
</body>
</html>

